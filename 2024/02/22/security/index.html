<!-- build time:Tue Oct 08 2024 13:53:58 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="人生当苦, 良人当归" href="https://fairyeye.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="人生当苦, 良人当归" href="https://fairyeye.github.io/atom.xml"><link rel="alternate" type="application/json" title="人生当苦, 良人当归" href="https://fairyeye.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><link rel="canonical" href="https://fairyeye.github.io/2024/02/22/security/"><title>security | Li = 人生当苦, 良人当归</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">security</h1><div class="meta"><span class="item" title="创建时间：2024-02-22 19:26:20"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2024-02-22T19:26:20+08:00">2024-02-22</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>14k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>13 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Li</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giclffsa1cj20zk0m811l.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipexbei4hj20zk0m8npd.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipeybxm1pj20zk0m8niv.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipevgoki5j20zk0m84qp.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipeuibk9fj20zk0m8ay2.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giciukx8a7j20zk0m8aio.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://fairyeye.github.io/2024/02/22/security/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="有李说不清"><meta itemprop="description" content=", 我不过像你像他像那野草野花。"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="人生当苦, 良人当归"></span><div class="body md" itemprop="articleBody"><h2 id="1"><a class="anchor" href="#1">#</a> 1.</h2><p>引入依赖：<br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>一些必要的配置：</p><p>新建一个配置类 <code>WebSecurityConfig</code> 继承 <code>WebSecurityConfigurerAdapter</code> 重写 <code>configure</code> 方法。（<strong>重要</strong>）</p><ul><li>是 SpringSecurity 的核心</li></ul><p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="comment">// 开启登录  </span></span><br><span class="line">        http.formLogin();  </span><br><span class="line">&#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>新建一个 controller 用来测试登录</p><p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zhanghuapeng  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/1/28  </span></span><br><span class="line"><span class="comment"> */</span><span class="meta">@RestController</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * 获取当前登录用户信息  </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user-info&quot;)</span>  </span><br><span class="line">    <span class="keyword">public</span> Authentication <span class="title function_">getUserInfo</span><span class="params">(Authentication authentication)</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> authentication;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>启动项目：终端会有这么一段日志<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Using generated security password: f429b724-db54-4a56-ae82-7ebb63f22d69</span><br></pre></td></tr></table></figure><br>表示：没有设置用户信息，给出了一个默认用户及密码，默认用户 <code>user</code><p></p><p>登录之后，默认会跳转到 Index 页面，但是目前没有这个页面，所以会报错。<br>暂不处理。</p><p>访问： <code>http://localhost:8080/user-info</code><br>返回结果：<br></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;credentials&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;details&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;authenticated&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;authorities&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;principal&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;not login!&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p></p><p>可以通过 <code>http://localhost:8080/logount</code> 退出登录</p><p>之后在访问 user-info 接口，发现不在包含用户信息</p><h2 id="2"><a class="anchor" href="#2">#</a> 2.</h2><p>实际使用中 没有登录的用户是不能访问接口的</p><p>修改 <code>WebSecurityConfig</code><br></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Configuration  </span><br><span class="line">public class WebSecurityConfig extends WebSecurityConfigurerAdapter &#123;  </span><br><span class="line">    @Override  </span><br><span class="line">    protected void configure(HttpSecurity http) throws Exception &#123;  </span><br><span class="line">        // 开启登录  </span><br><span class="line">        http.formLogin();  </span><br><span class="line">        // 设置访问权限  任何请求均需要认证（登录成功）才能访问  </span><br><span class="line">http.authorizeRequests().anyRequest().authenticated();    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>重启项目<br>此时，访问： <code>http://localhost:8080/user-info</code><br>发现会直接跳转到登录页面</p><h2 id="增加一些细节"><a class="anchor" href="#增加一些细节">#</a> 增加一些细节</h2><h3 id="依赖"><a class="anchor" href="#依赖">#</a> 依赖</h3><p></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- Web --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span>            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span>                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span>        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span>    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- Undertow --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-undertow<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- Security --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- Test --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--lombok--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--mybatis--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- 添加jwt的依赖 --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.auth0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>java-jwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.11.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--Redis--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><h3 id="配置"><a class="anchor" href="#配置">#</a> 配置</h3><p></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span>  </span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span>  </span><br><span class="line">  </span><br><span class="line"><span class="attr">spring:</span>  </span><br><span class="line">  <span class="attr">output:</span>  </span><br><span class="line">    <span class="attr">ansi:</span>  </span><br><span class="line">      <span class="attr">enabled:</span> <span class="string">always</span>   <span class="comment"># 强制启用 ansi 输出  </span></span><br><span class="line">  <span class="attr">datasource:</span>  </span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span>  </span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/security_study?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai</span>  </span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span>  </span><br><span class="line">    <span class="attr">password:</span> <span class="number">12345678</span>  </span><br><span class="line">  <span class="attr">redis:</span>  </span><br><span class="line">      <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>  </span><br><span class="line">      <span class="attr">port:</span> <span class="number">6379</span>  </span><br><span class="line">      <span class="attr">database:</span> <span class="number">1</span>  </span><br><span class="line"><span class="attr">jwt:</span>  </span><br><span class="line">    <span class="attr">secretKey:</span> <span class="string">a3e4cd2d191a017bf49dbdf49a4c62b1fb292c5b112d6a51bdc4e2ea5052e816</span>  </span><br><span class="line">    <span class="attr">expiration:</span> <span class="number">3600</span>  </span><br><span class="line">  </span><br><span class="line"><span class="attr">logging:</span>  </span><br><span class="line">  <span class="attr">pattern:</span>  </span><br><span class="line">    <span class="comment"># 控制台日志格式  </span></span><br><span class="line">    <span class="attr">console:</span> <span class="string">&quot;%clr(%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;)&#123;faint&#125; %clr(%5p) %clr($&#123;PID:- &#125;)&#123;magenta&#125; %clr(%-40.40logger&#123;39&#125;)&#123;cyan&#125; : %msg%n&quot;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="attr">mybatis:</span>  </span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.li.entity</span>  </span><br><span class="line">  <span class="attr">configuration:</span>  </span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span>  </span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span>  </span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br></pre></td></tr></table></figure><p></p><ol><li><p>在 <code>com.li</code> 新建 <code>utils</code> 包，新建 <code>JwtUtils</code><br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>  </span><br><span class="line"><span class="meta">@Slf4j</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtUtils</span> &#123;  </span><br><span class="line">    <span class="comment">//算法密钥  </span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jwt.secretKey&#125;&quot;)</span>  </span><br><span class="line">    <span class="keyword">private</span> String jwtSecretKey;  </span><br><span class="line">    <span class="comment">// 过期时间  </span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jwt.expiration&#125;&quot;)</span>  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> expiration;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * 创建jwt  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userInfo 用户信息  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> authList 用户权限列表  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回jwt（JSON WEB TOKEN）  </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">createToken</span><span class="params">(String userInfo, List&lt;String&gt; authList)</span> &#123;  </span><br><span class="line">        <span class="comment">//创建时间  </span></span><br><span class="line">        <span class="type">Date</span> <span class="variable">currentTime</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();  </span><br><span class="line">        <span class="comment">//过期时间，5分钟后过期  </span></span><br><span class="line">        <span class="type">Date</span> <span class="variable">expireTime</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(currentTime.getTime() + expiration);  </span><br><span class="line">        <span class="comment">//jwt 的header信息  </span></span><br><span class="line">        Map&lt;String, Object&gt; headerClaims = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        headerClaims.put(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;JWT&quot;</span>);  </span><br><span class="line">        headerClaims.put(<span class="string">&quot;alg&quot;</span>, <span class="string">&quot;HS256&quot;</span>);  </span><br><span class="line">        <span class="comment">//创建jwt  </span></span><br><span class="line">        <span class="keyword">return</span> JWT.create()  </span><br><span class="line">                .withHeader(headerClaims) <span class="comment">// 头部  </span></span><br><span class="line">                .withIssuedAt(currentTime) <span class="comment">//已注册声明：签发日期，发行日期  </span></span><br><span class="line">                .withExpiresAt(expireTime) <span class="comment">//已注册声明 过期时间  </span></span><br><span class="line">                .withIssuer(<span class="string">&quot;thomas&quot;</span>)  <span class="comment">//已注册声明，签发人  </span></span><br><span class="line">                .withClaim(<span class="string">&quot;userInfo&quot;</span>, userInfo) <span class="comment">//私有声明，可以自己定义  </span></span><br><span class="line">                .withClaim(<span class="string">&quot;authList&quot;</span>, authList) <span class="comment">//私有声明，可以自定义  </span></span><br><span class="line">                .sign(Algorithm.HMAC256(jwtSecretKey)); <span class="comment">// 签名，使用HS256算法签名，并使用密钥  </span></span><br><span class="line"><span class="comment">//        HS256是一种对称算法，这意味着只有一个密钥，在双方之间共享。 使用相同的密钥生成签名并对其进行验证。 应特别注意钥匙是否保密。  </span></span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * 验证jwt的签名，简称验签  </span></span><br><span class="line"><span class="comment">     *  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token 需要验签的jwt  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 验签结果  </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">verifyToken</span><span class="params">(String token)</span> &#123;  </span><br><span class="line">        <span class="comment">//获取验签类对象  </span></span><br><span class="line">        <span class="type">JWTVerifier</span> <span class="variable">jwtVerifier</span> <span class="operator">=</span> JWT.require(Algorithm.HMAC256(jwtSecretKey)).build();  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="comment">//验签，如果不报错，则说明jwt是合法的，而且也没有过期  </span></span><br><span class="line">            <span class="type">DecodedJWT</span> <span class="variable">decodedJWT</span> <span class="operator">=</span> jwtVerifier.verify(token);  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (JWTVerificationException e) &#123;  </span><br><span class="line">            <span class="comment">//如果报错说明jwt 为非法的，或者已过期（已过期也属于非法的）  </span></span><br><span class="line">            log.error(<span class="string">&quot;验签失败：&#123;&#125;&quot;</span>, token);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * 获取用户id  </span></span><br><span class="line"><span class="comment">     *     * <span class="doctag">@param</span> token jwt  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户id  </span></span><br><span class="line"><span class="comment">     */</span>    <span class="keyword">public</span> String <span class="title function_">getUserInfo</span><span class="params">(String token)</span> &#123;  </span><br><span class="line">        <span class="comment">//创建jwt验签对象  </span></span><br><span class="line">        <span class="type">JWTVerifier</span> <span class="variable">jwtVerifier</span> <span class="operator">=</span> JWT.require(Algorithm.HMAC256(jwtSecretKey)).build();  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="comment">//验签  </span></span><br><span class="line">            <span class="type">DecodedJWT</span> <span class="variable">decodedJWT</span> <span class="operator">=</span> jwtVerifier.verify(token);  </span><br><span class="line">            <span class="comment">//获取payload中userInfo的值，并返回  </span></span><br><span class="line">            <span class="keyword">return</span> decodedJWT.getClaim(<span class="string">&quot;userInfo&quot;</span>).asString();  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (JWTVerificationException e) &#123;  </span><br><span class="line">            log.error(<span class="string">&quot;getUserInfo error&quot;</span>, e);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * 获取用户权限  </span></span><br><span class="line"><span class="comment">     *  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getUserAuth</span><span class="params">(String token)</span> &#123;  </span><br><span class="line">        <span class="comment">//创建jwt验签对象  </span></span><br><span class="line">        <span class="type">JWTVerifier</span> <span class="variable">jwtVerifier</span> <span class="operator">=</span> JWT.require(Algorithm.HMAC256(jwtSecretKey)).build();  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="comment">//验签  </span></span><br><span class="line">            <span class="type">DecodedJWT</span> <span class="variable">decodedJWT</span> <span class="operator">=</span> jwtVerifier.verify(token);  </span><br><span class="line">            <span class="comment">//获取payload中的自定义数据authList（权限列表），并返回  </span></span><br><span class="line">            <span class="keyword">return</span> decodedJWT.getClaim(<span class="string">&quot;authList&quot;</span>).asList(String.class);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (JWTVerificationException e) &#123;  </span><br><span class="line">            log.error(<span class="string">&quot;getUserAuth error&quot;</span>, e);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p></li><li><p>在 <code>com.li</code> 新建 <code>filter</code> 包，新建 <code>SaySomethingJWTFilter</code><br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zhanghuapeng  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/2/22  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desc</span> 一次性请求过滤器  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="meta">@Component</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SaySomethingJWTFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;  </span><br><span class="line">    <span class="meta">@Resource</span>  </span><br><span class="line">    <span class="keyword">private</span> ObjectMapper objectMapper;  </span><br><span class="line">    <span class="meta">@Resource</span>  </span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;  </span><br><span class="line">    <span class="meta">@Resource</span>  </span><br><span class="line">    <span class="keyword">private</span> JwtUtils jwtUtils;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;  </span><br><span class="line">        <span class="comment">//获取请求uri  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">requestURI</span> <span class="operator">=</span> request.getRequestURI();  </span><br><span class="line">        <span class="comment">// 如果是登录页面，放行  </span></span><br><span class="line">        <span class="keyword">if</span> (requestURI.equals(<span class="string">&quot;/login&quot;</span>)) &#123;  </span><br><span class="line">            filterChain.doFilter(request, response);  </span><br><span class="line">            <span class="keyword">return</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="comment">//获取请求头中的Authorization  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">authorization</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;Authorization&quot;</span>);  </span><br><span class="line">        <span class="comment">//如果Authorization为空，那么不允许用户访问，直接返回  </span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(authorization)) &#123;  </span><br><span class="line">            printFront(response, <span class="string">&quot;没有登录！&quot;</span>);  </span><br><span class="line">            <span class="keyword">return</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//Authorization 去掉头部的Bearer 信息，获取token值  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jwtToken</span> <span class="operator">=</span> authorization.replace(<span class="string">&quot;Bearer &quot;</span>, <span class="string">&quot;&quot;</span>);  </span><br><span class="line">        <span class="comment">//验签  </span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">verifyTokenResult</span> <span class="operator">=</span> jwtUtils.verifyToken(jwtToken);  </span><br><span class="line">        <span class="comment">//验签不成功  </span></span><br><span class="line">        <span class="keyword">if</span> (!verifyTokenResult) &#123;  </span><br><span class="line">            printFront(response, <span class="string">&quot;jwtToken 已过期&quot;</span>);  </span><br><span class="line">            <span class="keyword">return</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//从payload中获取userInfo  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userInfo</span> <span class="operator">=</span> jwtUtils.getUserInfo(jwtToken);  </span><br><span class="line">        <span class="comment">//从payload中获取授权列表  </span></span><br><span class="line">        List&lt;String&gt; userAuth = jwtUtils.getUserAuth(jwtToken);  </span><br><span class="line">        <span class="comment">//创建登录用户  </span></span><br><span class="line">        <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> objectMapper.readValue(userInfo, SysUser.class);  </span><br><span class="line">        <span class="type">SecurityUser</span> <span class="variable">securityUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecurityUser</span>(sysUser);  </span><br><span class="line">          </span><br><span class="line">        <span class="comment">//设置权限  </span></span><br><span class="line">        List&lt;SimpleGrantedAuthority&gt; authList = userAuth.stream().map(SimpleGrantedAuthority::<span class="keyword">new</span>).collect(Collectors.toList());  </span><br><span class="line">        securityUser.setAuthorities(authList);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">usernamePasswordAuthenticationToke</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(securityUser  </span><br><span class="line">                , <span class="literal">null</span>, authList);  </span><br><span class="line">        <span class="comment">//通过安全上下文设置认证信息  </span></span><br><span class="line">        SecurityContextHolder.getContext().setAuthentication(usernamePasswordAuthenticationToke);  </span><br><span class="line">        <span class="comment">//继续访问相应的rul等  </span></span><br><span class="line">        filterChain.doFilter(request, response);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">printFront</span><span class="params">(HttpServletResponse response, String message)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        response.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);  </span><br><span class="line">        response.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);  </span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> response.getWriter();  </span><br><span class="line">        <span class="type">HttpResult</span> <span class="variable">httpResult</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpResult</span>();  </span><br><span class="line">        httpResult.setCode(-<span class="number">1</span>);  </span><br><span class="line">        httpResult.setMsg(message);  </span><br><span class="line">  </span><br><span class="line">        writer.print(objectMapper.writeValueAsString(httpResult));  </span><br><span class="line">        writer.flush();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p></li><li><p>调整 <code>SecurityConfig</code> , 将过滤器添加到配置中<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span>  </span><br><span class="line"><span class="keyword">private</span> SaySTokenFilter saySTokenFilter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">  <span class="comment">// 增加配置</span></span><br><span class="line">    http.addFilterBefore(saySomethingJWTFilter, UsernamePasswordAuthenticationFilter.class);  </span><br><span class="line"><span class="comment">// ...原来的配置</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p></li></ol><h5 id="调试"><a class="anchor" href="#调试">#</a> 调试</h5><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 不携带token访问http://localhost:8080/user-info</span><br><span class="line">返回：&#123;&quot;code&quot;:-1,&quot;msg&quot;:&quot;没有登录！&quot;,&quot;data&quot;:null&#125;</span><br><span class="line"># 携带错误token访问http://localhost:8080/user-info</span><br><span class="line">返回：&#123;&quot;code&quot;:-1,&quot;msg&quot;:&quot;jwtToken 已过期&quot;,&quot;data&quot;:null&#125;</span><br></pre></td></tr></table></figure><p></p><ol start="4"><li>在 <code>com.li.config</code> , 新建 <code>SaySAuthenticationSuccessHandler</code></li></ol><h4 id="设置权限"><a class="anchor" href="#设置权限">#</a> 设置权限</h4><p><strong>在 loadUserByUsername 中获取权限，并设置到 SecurityUser 中</strong></p><p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// com.li.service.impl.UserServiceImpl</span></span><br><span class="line"></span><br><span class="line"><span class="type">SecurityUser</span> <span class="variable">securityUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecurityUser</span>(sysUser);  </span><br><span class="line"><span class="comment">// 获取权限信息  </span></span><br><span class="line">List&lt;String&gt; authList = sysMenuDao.queryPermissionByUserId(sysUser.getUserId());  </span><br><span class="line"><span class="keyword">if</span> (!CollectionUtils.isEmpty(authList)) &#123;  </span><br><span class="line">    List&lt;SimpleGrantedAuthority&gt; authorities = authList.stream().map(SimpleGrantedAuthority::<span class="keyword">new</span>).collect(toList());  </span><br><span class="line">    <span class="comment">// 设置权限  </span></span><br><span class="line">    securityUser.setAuthorities(authorities);  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">return</span> securityUser;</span><br></pre></td></tr></table></figure><p></p><p>在 SaySAuthenticationSuccessHandler.onAuthenticationSuccess 中，生成 Token 时，可以将权限信息一起放入 Token 中。</p><p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; authList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line"><span class="comment">// 获取权限  </span></span><br><span class="line">List&lt;SimpleGrantedAuthority&gt; authorities = (List&lt;SimpleGrantedAuthority&gt;) securityUser.getAuthorities();  </span><br><span class="line"><span class="keyword">if</span> (!CollectionUtils.isEmpty(authorities)) &#123;  </span><br><span class="line">    <span class="comment">// 转成String 用于生成Token  </span></span><br><span class="line">    authList = authorities.stream().map(SimpleGrantedAuthority::getAuthority).collect(Collectors.toList());  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建Token  增加authList参数</span></span><br><span class="line"><span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> saySJwtUtils.createToken(userInfo, authList);</span><br></pre></td></tr></table></figure><p></p><h4 id="注销处理"><a class="anchor" href="#注销处理">#</a> 注销处理</h4><p><strong>Jwt 本质上是一个字符串，无法手动将其过期，也就是说，即使手动退出登录，对于 Token 来说，还是一个有效的 Token，可以通过接入 Redis 来解决这一问题</strong></p><ol><li><p>登录成功时，将 Token 写入 Redis<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SaySAuthenticationSuccessHandler</span></span><br><span class="line"><span class="comment">// 设置过期时间  </span></span><br><span class="line"><span class="meta">@Value(&quot;$&#123;jwt.expiration&#125;&quot;)</span>  </span><br><span class="line"><span class="keyword">private</span> <span class="type">long</span> expiration;</span><br><span class="line"><span class="comment">// 引入StringRedisTemplate</span></span><br><span class="line"><span class="meta">@Resource</span>  </span><br><span class="line"><span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在创建Token之后，将Token存到Redis中</span></span><br><span class="line"></span><br><span class="line">onAuthenticationSuccess()&#123;</span><br><span class="line"><span class="comment">// 创建Token  </span></span><br><span class="line"><span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> saySJwtUtils.createToken(userInfo, authList);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写入Redis  </span></span><br><span class="line">stringRedisTemplate.opsForValue().set(<span class="string">&quot;login_token:&quot;</span> + token, objectMapper.writeValueAsString(authentication), expiration, TimeUnit.MILLISECONDS);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p></li><li><p>校验 Token 时，先验签，再去 Redis 中判断 Token 是否还存在</p></li></ol><ul><li>如果验签成功，但是 Redis 中不存在，说明 Token 被手动过期了<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">doFilterInternal()&#123;</span><br><span class="line">...</span><br><span class="line"><span class="comment">// 从Redis获取token并校验  </span></span><br><span class="line"><span class="type">String</span> <span class="variable">tokenInRedis</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(<span class="string">&quot;login_token:&quot;</span> + jwtToken);  </span><br><span class="line"><span class="keyword">if</span> (!StringUtils.hasText(tokenInRedis)) &#123;  </span><br><span class="line">    printFront(response, <span class="string">&quot;用户已退出，请重新登录&quot;</span>);  </span><br><span class="line">    <span class="keyword">return</span>;  </span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>在 <code>com.li.config</code> ，新建 <code>SaysLogoutSuccessHandler</code><br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 退出成功处理器，用户退出成功后，执行此处理器  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="meta">@Component</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SaysLogoutSuccessHandler</span> <span class="keyword">implements</span> <span class="title class_">LogoutSuccessHandler</span> &#123;  </span><br><span class="line">    <span class="comment">//使用此工具类的对象进行序列化操作  </span></span><br><span class="line">    <span class="meta">@Resource</span>  </span><br><span class="line">    <span class="keyword">private</span> ObjectMapper objectMapper;  </span><br><span class="line">    <span class="meta">@Resource</span>  </span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onLogoutSuccess</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Authentication authentication)</span> <span class="keyword">throws</span> IOException, ServletException &#123;  </span><br><span class="line">        <span class="comment">//从请求头中获取Authorization信息  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">authorization</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;Authorization&quot;</span>);  </span><br><span class="line">        <span class="comment">//如果授权信息为空，返回前端  </span></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == authorization) &#123;  </span><br><span class="line">            response.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);  </span><br><span class="line">            response.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);  </span><br><span class="line">            <span class="type">HttpResult</span> <span class="variable">httpResult</span> <span class="operator">=</span> HttpResult.builder().code(-<span class="number">1</span>).msg(<span class="string">&quot;token不能为空&quot;</span>).build();  </span><br><span class="line">            <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> response.getWriter();  </span><br><span class="line">            writer.write(objectMapper.writeValueAsString(httpResult));  </span><br><span class="line">            writer.flush();  </span><br><span class="line">            <span class="keyword">return</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="comment">//如果Authorization信息不为空，去掉头部的Bearer字符串  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> authorization.replace(<span class="string">&quot;Bearer &quot;</span>, <span class="string">&quot;&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//redis中删除token，这是关键点  </span></span><br><span class="line">        stringRedisTemplate.delete(<span class="string">&quot;login_token:&quot;</span> + token);  </span><br><span class="line">  </span><br><span class="line">        response.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);  </span><br><span class="line">        response.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);  </span><br><span class="line">        <span class="type">HttpResult</span> <span class="variable">httpResult</span> <span class="operator">=</span> HttpResult.builder().code(<span class="number">200</span>).msg(<span class="string">&quot;退出成功&quot;</span>).build();  </span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> response.getWriter();  </span><br><span class="line">        writer.write(objectMapper.writeValueAsString(httpResult));  </span><br><span class="line">        writer.flush();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>调整 <code>SecurityConfig</code><br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Resource</span>  </span><br><span class="line"><span class="keyword">private</span> SaysLogoutSuccessHandler saysLogoutSuccessHandler;</span><br><span class="line"></span><br><span class="line">configure()&#123;</span><br><span class="line">http.logout().logoutSuccessHandler(saysLogoutSuccessHandler);</span><br><span class="line"><span class="comment">// 禁用跨域请求保护 要不然logout不能访问(目前体现是弹出了确认退出登录的确认框  </span></span><br><span class="line">http.csrf().disable();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><code>org.springframework.security.authentication.dao.AbstractUserDetailsAuthenticationProvider#authenticate</code><br><code>org.springframework.security.authentication.dao.DaoAuthenticationProvider#retrieveUser</code></p><p><code>org.springframework.security.authentication.dao.DaoAuthenticationProvider#additionalAuthenticationChecks</code></p></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2024-02-23 16:08:37" itemprop="dateModified" datetime="2024-02-23T16:08:37+08:00">2024-02-23</time> </span><span id="2024/02/22/security/" class="item leancloud_visitors" data-flag-title="security" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="有李说不清 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="有李说不清 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="有李说不清 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>有李说不清 <i class="ic i-at"><em>@</em></i>人生当苦, 良人当归</li><li class="link"><strong>本文链接：</strong> <a href="https://fairyeye.github.io/2024/02/22/security/" title="security">https://fairyeye.github.io/2024/02/22/security/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2024/01/19/Leetcode/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipeubcbajj20zk0m8h1h.jpg" title="未命名"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i></span><h3>未命名</h3></a></div><div class="item right"><a href="/2024/03/13/Spring%20Boot%20Admin/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giph4fomxoj20zk0m8axp.jpg" title="Spring Boot Admin"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> java</span><h3>Spring Boot Admin</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1"><span class="toc-number">1.</span> <span class="toc-text">1.</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2"><span class="toc-number">2.</span> <span class="toc-text">2.</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E4%B8%80%E4%BA%9B%E7%BB%86%E8%8A%82"><span class="toc-number">3.</span> <span class="toc-text">增加一些细节</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96"><span class="toc-number">3.1.</span> <span class="toc-text">依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.</span> <span class="toc-text">配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B0%83%E8%AF%95"><span class="toc-number">3.2.0.1.</span> <span class="toc-text">调试</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%9D%83%E9%99%90"><span class="toc-number">3.2.1.</span> <span class="toc-text">设置权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E9%94%80%E5%A4%84%E7%90%86"><span class="toc-number">3.2.2.</span> <span class="toc-text">注销处理</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="有李说不清" data-src="/images/avatar.jpg"><p class="name" itemprop="name">有李说不清</p><div class="description" itemprop="description">我不过像你像他像那野草野花。</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">46</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">9</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">20</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ZhaXJ5ZXll" title="https:&#x2F;&#x2F;github.com&#x2F;fairyeye"><i class="ic i-github"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2024/01/19/Leetcode/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2024/03/13/Spring%20Boot%20Admin/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"></div><span><a href="/2024/02/22/security/" title="security">security</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%9D%82%E9%A1%B9/" title="分类于 杂项">杂项</a></div><span><a href="/2022/12/07/%E6%90%AD%E5%BB%BASSR%E6%9C%8D%E5%8A%A1%E5%99%A8/" title="搭建SSR服务器">搭建SSR服务器</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/09/09/%E6%9C%AA%E5%91%BD%E5%90%8D/" title="未命名">未命名</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="分类于 学习笔记">学习笔记</a></div><span><a href="/2020/04/20/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%AC%94%E8%AE%B0/" title="设计模式笔记">设计模式笔记</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/06/05/Springboot%E8%BF%94%E5%9B%9Ehtml/" title="Springboot">Springboot</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/06/08/%E8%8B%8F%E5%B7%9E%E4%B8%80%E6%97%A5%E6%B8%B8/" title="苏州一日游">苏州一日游</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/09/25/231104/" title="231104">231104</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/12/25/Algo/" title="Hello Algo">Hello Algo</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/06/05/Delete%20&%20Truncate/" title="Delete&#x2F;Truncate&#x2F;Drop">Delete/Truncate/Drop</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="分类于 学习笔记">学习笔记</a></div><span><a href="/2020/04/20/Go%E7%AC%94%E8%AE%B0/" title="Go笔记">Go笔记</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">有李说不清 @ Li</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">90k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">1:22</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2024/02/22/security/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->