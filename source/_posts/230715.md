---
title: 230715
date: 2023-06-14 13:55:08
tags: work
hidden: true
---

### pur-19895

需求点：
	无需屏蔽标准取消逻辑，如果传了Erp审批标识为1，取消标识也为1，允许取消订单。
	
埋点脚本：
	SPUC_ORDER_SYNC_IMP_PROCESS
	

#### pur-19896

需求点：
	不要影响取消校验
	- 发货工作台校验了关闭，标准增加埋点脚本，发货工作台校验去掉关闭的发运行

种子数据：
	埋点脚本：
		SPUC_PO_SYNC_FINISH_STATE_VALIDATE
		SPUC_HANDLE_VALIDATE_DELIVERY_DATA_ADAPTOR
	QB：
		SCUX_HAIROBOTICS_NEW_ASN_BY_PO_LINE
	标准代码：feature-pur-19896


### pur-20042

种子数据：
	SPUC_ORDER_IMPORT_VALIDATOR_FROM_EXTERNAL 
返回消息：spuc.error.po_change_not_allowed_for_wlxy
	
quantity、secondaryQuantity、needByDate、unitPrice、enteredTaxIncludedPrice、lineAmount、taxIncludedLineAmount（即需求日期、所有数量、所有价格信息），此外采购员可能新增行


### pur-19202

	导出
	接口更新订单，入口处屏蔽了SQL拦截器，导致不会更新pe_supplier

##### 二开租户：

二开SQL：
	发运行：
		%%MARKOR  美克美家？%%
		Watsons   屈臣氏
	订单行：
		%%MARKOR  美克美家？%%
	订单头：
		新建查询
			grwl    广日物流
			Chinatool   英华利
		订单头查询：
			Watsons   屈臣氏
二开值集：无二开

二开页面个性化值集字段：
```sql
select ht.tenant_name,ht.tenant_id,c.unit_code,d.source_code,a.*
from hpfm_cusz_config_field a
join hpfm_cusz_unit_field b on a.table_name=b.table_name and a.unit_id=b.unit_id and a.field_code=b.field_code
join hpfm_cusz_unit c on c.id =b.unit_id
left join hpfm_tenant ht on ht.tenant_id = a.tenant_id
left join hpfm_cusz_config_field_wdg d on d.config_field_id = a.config_field_id
where c.unit_code in ('SODR.WORKSPACE_TOBERELEASED.SEARCH', 'SODR.WORKSPACE_FEEDBACKUNDERREVIEW.SEARCH','SODR.WORKSPACE_TOBESIGNED.SEARCH','SODR.WORKSPACE_TOBESUBMITED.SEARCH','SODR.WORKSPACE_ALL.SERARCH','SODR.WORKSPACE_UNDERAPPROVAL.SEARCH','SODR.WORKSPACE_DETAILALL.SEARCH','SODR.WORKSPACE_DETAILFEEDBACK.SEARCH','SODR.WORKSPACE_SOURCINGRESULTS.SEARCH','SODR.WORKSPACE_PURCHASEAGREEMENT.SEARCH','SODR.WORKSPACE_PURCHASEREQUEST.SEARCH')
and (a.field_alias = 'tempKey' or a.field_alias = 'tempKeys')
and a.tenant_id != 28344 and a.tenant_id != 65
```


### pur-20130

脚本：
	1. 点击按行拒绝 状态校验api    `SCUX_JINKOSOLAR_PO_LINE_REJECT_CHECK`     前端做
	2. 更新行拒绝标识api（包含发送消息，写入操作记录 带行号，满足条件的情况更新头拒绝标识     `SCUX_JINKOSOLAR_PO_LINE_REJECT`     已完成
	3. 反馈过滤按行拒绝为是的行-适配器     
	4. 整单确认适配器 SPUC_HANDLE_CONFIRM_PO_LINE_LOCATION_ADAPTOR
	5. 重新发布更新拒绝标识api      `SCUX_JINKOSOLAR_PO_LINE_PUBLISH`  已完成
	6. **值集**：  SODR.PROCESS_TYPE_CODE，  SODR.CHANGE_TYPE_CODE    已完成
	7. 适配器：SPUC_ORDER_QUERY_PROCESS_ACTION   操作记录   已完成
	8. 去掉原需求查询逻辑  已完成
	9. 增加按行拒绝按钮 前端做
	10. 修改拒绝按钮  整单拒绝   前端做
	11. 列表页配出字段  
注意：
	反馈/确认   列表页确认
	按明细查询 去掉原查询逻辑  
	消息除参数外一致，可以使用整单消息  已确认
	已拒绝的行+限制   已确认
	重新打开 是否需要状态限制（头、行
	操作记录：展示小三角点开，需要前端特殊处理，或者显示变更订单
![](https://s3.bmp.ovh/imgs/2023/06/21/069d0d8bfa25cdab.png)

![](https://s3.bmp.ovh/imgs/2023/06/21/1257802c8506229c.png)


###### 待定

操作记录，动作 是记录按行拒绝还是变更


### pur-18932

配置表：scux_srm_ntes_valid_domestic_po_amount
埋点脚本：SPUC_ORDER_BATCH_SUBMIT_HANDLE
返回消息：error.ntes.pc_is_empty


### pur-19968

埋点：参考pur-9324，二开代码

	SPUC_ORDER_IMPORT_VALIDATOR_FROM_EXTERNAL
	SPUC_SUBMIT_PO
	SPUC_LINE_CANCEL_PO_LINE_NEW
	SPUC_LINE_CLOSE_PO_LINE
	SPUC_ALL_CLOSE_PO_LINE
	SPUC_ORDER_REJECTED_EVENT
	SPUC_LINE_CANCEL_PO_LINE
	SPUC_ALL_CANCEL_PO_LINE
	SPUC_PO_BUDGET_EXTERNAL_SYSTEM_PROCESS


### pur-19974
	SPUC_ALL_CLOSE_PO_LINE
	SPUC_LINE_CLOSE_PO_LINE
	SPUC_ALL_CANCEL_PO_LINE
	SPUC_LINE_CANCEL_PO_LINE
![](https://s3.bmp.ovh/imgs/2023/06/26/261e99c466d7355a.png)


### pur-20133

	确认：SPUC_ORDER_CONFIRM_AFTER
	确认：SPUC_ORDER_CONFIRM_LINE

	取消：SPUC_ALL_CANCEL_PO_LINE
	            SPUC_LINE_CANCEL_PO_LINE
	            SPUC_LINE_CANCEL_PO_LINE_NEW

PO20230628000001


### pur-15827

	QB：SCUX_NARWAL_BATCH_APPROVE_QUERY  增加备注字段
	独立脚本：SCUX_NARWAL_BATCH_APPROVE_QUERY   

新增脚本：
	关联单据查询信息：SCUX_NARWAL_PR_RELATED_PO
独立API：SCUX_NARWAL_PR_RELATED_PO
QB：SCUX_NARWAL_PR_RELATED_PO_QUERY

#### pur-20805

配置表
	scux_srm_markor_srm_markor_sodr_close_attachment
整单取消、关闭，整单关闭、按行关闭

	SPUC_ALL_CLOSE_PO_LINE
	SPUC_LINE_CLOSE_PO_LINE
	SPUC_ALL_CANCEL_PO_LINE
	SPUC_LINE_CANCEL_PO_LINE





#### pur-