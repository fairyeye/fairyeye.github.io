
# 1.新增标准表结构 

```
# 供货能力申请单头表
sslm_supply_ability_change_req
# 供货能力申请单行表
sslm_supply_ability_change_line
# 供货能力申请单行附件表
sslm_supply_ability_change_att_ln
# 供货能力申请单操作记录表
sslm_supply_ability_change_record
```

# 2.表结构Groovy脚本 

```groovy
# srm-resource/init-db/srm/groovy/srm_supplier
sslm_supply_ability_change_req.groovy
sslm_supply_ability_change_line.groovy
sslm_supply_ability_change_att_ln.groovy
sslm_supply_ability_change_record.groovy
```

# 3.接口&权限

## 3.1 功能接口

### 3.1.1供货能力申请单（采）   

权限编码：`srm.partner.suplier-ability.fesc-ability-apply.ps.default`

#### A.列表页

##### 列表-整单-待提交

GET：`/v1/{organizationId}/supply-ability-change-reqs/to-submit`

返回：
```json
{  
    "totalPages": 1,  
    "totalElements": 1,  
    "numberOfElements": 1,  
    "size": 20,  
    "number": 0,  
    "content": [  
        {  
            "creationDate": "2024-06-03 13:56:26",  // 创建时间
            "createdBy": 495599,  
            "abilityReqId": "__-bxlDa-c9iJhSjBdwFOhxbQ-__",  
            "abilityReqNum": "SA202406030006",  // 单号
            "abilityReqStatus": "NEW",  
            "initiateCamp": 0,  
            "companyId": "__-y6I0cyH7xztAKenqOKhQCw-__",  
            "supplierTenantId": "__-YlG3r4DurffZeRPxiqAjpQ-__",  
            "supplierCompanyId": "__-pHTMaFNSRR8ujJ3lj7BGsg-__",  
            "abilityReqStatusMeaning": "新建",  // 状态
            "initiateCampMeaning": "采购方",  // 申请单发起方
            "companyNum": "CO00023721",  // 公司编码
            "companyName": "测试邀约子公司",  // 公司名称
            "supplierCompanyNum": "CO00000198",  // 供应商编码
            "supplierCompanyName": "厦门古龙食品有限公司",  // 供应商名称
            "createdUserName": "张华朋"  // 创建人
        }  
    ],  
    "needCountFlag": null,  
    "empty": false  
}
```

##### 列表-整单-审批中

GET：`/v1/{organizationId}/supply-ability-change-reqs/to-approval`

##### 列表-整单-全部

GET：`/v1/{organizationId}/supply-ability-change-reqs/all`

##### 列表-明细-全部

POST：`/v1/{organizationId}/supply-ability-change-lines/all`

#### B.列表页按钮

##### 新建

GET 请求
`/sample-send-reqs/getUserAndUserMasterUnit`

##### 批量删除

DELETE：`/v1/{organizationId}/supply-ability-change-reqs`

传入申请单头ID数组
```json
[  
    "__-CDZ74LTm8ZzTZV1rugAUDUc-uquMzaDB5tx5SZXNkhg-__",  
    "__-CDZ74LTm8ZzTZV1rugAUDdCAl4rc5gdI1nmC-seo6fU-__",  
    "__-aeSQQzoLH_NdygOMfSEGyYEPXZb1MhNmhFMgA_V81_w-__"  
]
```


##### 批量审批

POST：`/v1/{organizationId}/supply-ability-change-reqs/batch-approve`
请求参数：
```json

```

返回参数：
```json


```
##### 导出


#### C.明细页

##### 头查询

GET：`/v1/{organizationId}/supply-ability-change-reqs/{abilityReqId}`

返回：
```json
{  
    "creationDate": "2024-06-03 14:35:05",  
    "createdBy": 495599,  
    "objectVersionNumber": 3,  
    "_token": "u332RWp5wzb6zhbEz7rHlui8NEgcHXhcu6C7plAqVSp+HmJ4NYvuBSd6V6At2quvJPt26lRAfWhK5zi33D3Jqv96lKN1PMGs+dt7t0BItPaZYat6MPjyd7OXePMR/yzu",  
    "abilityReqId": "__-0ICXitzmB0jWeYL6x6jp9Q-__",  
    "abilityReqNum": "SA202406030007",  
    "abilityReqStatus": "NEW",  
    "initiateCamp": 0,  
    "companyId": "__-y6I0cyH7xztAKenqOKhQCw-__",  
    "supplierTenantId": "__-YlG3r4DurffZeRPxiqAjpQ-__",  
    "supplierCompanyId": "__-pHTMaFNSRR8ujJ3lj7BGsg-__",  
    "remark": "这是一个备注233",  
    "abilityReqStatusMeaning": "新建",  
    "initiateCampMeaning": "采购方",  
    "companyNum": "CO00023721",  
    "companyName": "测试邀约子公司",  
    "supplierCompanyNum": "CO00000198",  
    "supplierCompanyName": "厦门古龙食品有限公司",  
    "createdUserName": "张华朋"  
}
```
##### 行查询

POST：`/v1/{organizationId}/supply-ability-change-lines/{abilityReqId}`

#### D.明细页按钮-头

##### 保存

POST： `/v1/{organizationId}/supply-ability-change-reqs/save`
##### 提交

POST： `/v1/{organizationId}/supply-ability-change-reqs/submit`
##### 删除

DELETE：`/v1/{organizationId}/supply-ability-change-reqs`

传入申请单头ID数组
```json
[  
    "__-CDZ74LTm8ZzTZV1rugAUDUc-uquMzaDB5tx5SZXNkhg-__",  
    "__-CDZ74LTm8ZzTZV1rugAUDdCAl4rc5gdI1nmC-seo6fU-__",  
    "__-aeSQQzoLH_NdygOMfSEGyYEPXZb1MhNmhFMgA_V81_w-__"  
]
```


##### 操作记录

GET： `/v1/{organizationId}/supply-ability-change-records/{abilityReqId}`

#### E.明细按钮-行

##### 新增


##### 变更已有供货能力


##### 批量删除


##### 批量编辑


#### F.工作流接口

##### 审批通过

GET：`/wfl/approve/{abilityReqId}`

##### 审批拒绝

GET：`/wfl/reject/{abilityReqId}`

##### 工作流撤销

GET：`/wfl/cancel/{abilityReqId}`


### 3.1.2 供货能力申请单（供）

#### A.列表页

##### 列表-整单-待提交

GET：`/v1/{organizationId}/supply-ability-change-reqs/sup/to-submit`

##### 列表-整单-全部

GET：`/v1/{organizationId}/supply-ability-change-reqs/sup/all`


#### B.列表页按钮

##### 新建

GET 请求
`/sample-send-reqs/getUserAndUserMasterUnit`

##### 批量删除

DELETE：`/v1/{organizationId}/supply-ability-change-reqs`

传入申请单头ID数组
```json
[  
    "__-CDZ74LTm8ZzTZV1rugAUDUc-uquMzaDB5tx5SZXNkhg-__",  
    "__-CDZ74LTm8ZzTZV1rugAUDdCAl4rc5gdI1nmC-seo6fU-__",  
    "__-aeSQQzoLH_NdygOMfSEGyYEPXZb1MhNmhFMgA_V81_w-__"  
]
```

##### 导出


#### C.明细页

##### 头查询

GET：`/v1/{organizationId}/supply-ability-change-reqs/sup/{abilityReqId}`
##### 行查询

POST：`/v1/{organizationId}/supply-ability-change-lines/{abilityReqId}`

#### D.明细页按钮-头

##### 保存

POST： `/v1/{organizationId}/supply-ability-change-reqs/sup/save`
##### 提交

POST： `/v1/{organizationId}/supply-ability-change-reqs/sup/submit`
##### 删除

DELETE：`/v1/{organizationId}/supply-ability-change-reqs`

传入申请单头ID数组
```json
[  
    "__-CDZ74LTm8ZzTZV1rugAUDUc-uquMzaDB5tx5SZXNkhg-__",  
    "__-CDZ74LTm8ZzTZV1rugAUDdCAl4rc5gdI1nmC-seo6fU-__",  
    "__-aeSQQzoLH_NdygOMfSEGyYEPXZb1MhNmhFMgA_V81_w-__"  
]
```


##### 操作记录

GET： `/v1/{organizationId}/supply-ability-change-records/{abilityReqId}`

#### E.明细按钮-行

##### 新增


##### 变更已有供货能力


##### 批量删除

DELETE：`/v1/{organizationId}/supply-ability-change-lines`

传入申请行ID对象的数组
```json
[  
    {  
        "abilityChangeLineId": "__-CNzKB7nYI-lnTjgD1Gqvjw-__"  
    }  
]
```


##### 批量编辑

POST：`/v1/{organizationId}/supply-ability-change-lines/bach-update`

传入申请行单个对象，包含申请头ID以及需要批量编辑的字段
```json
# 参考编辑供货能力清单 行批量编辑
当勾选指定行进行批量编辑时：和整个页面保存传入同样的参数，头字段增加selectFlag = 1 
当不勾选行，全部批量编辑时：传入supplyAbilityChangeLineUpdateDTO，包含需要更新的字段
```


## 3.3 采购方菜单权限

```
// 需要查询用户信息 把带单权限加上
/sample-send-reqs/getUserAndUserMasterUnit

```


# 4.配置项 

## 4.1 值集

`SSLM.SUPPLY_ABILITY_REQ_STATUS`
`SSLM.INITIATE_CAMP`
`SSLM.ABILITY_OPERATION_TYPE`
`SSLM.SUPPLY_ABILITY_REQ_APPROVE_TYPE`
## 4.2 编码规则

`SSLM.SUPPLY_ABILITY_REQ_NUM`

## 4.3 报错信息

`sslm.error.supplier_uncompleted_ability_req`
`sslm.error.company_supplier_uncompleted_ability_req`
`sslm.error.supplier_supply_ability_req_status`

## 4.4 业务对象

`SRM_SSLM_SUPPLY_ABILITY_CHANGE_REQ`

## 4.5 工作流

##### 流程分类：SSLM_SA_REQ_CATEGORY
##### 流程单据：SSLM_SA_REQ_DOCUMENT
##### 流程编码：SSLM.SUPPLY_ABILITY_REQ_WFL


### 接口定义

`SSLM.SUPPLY_ABILITY_REQ_APPROVE`    
`SSLM.SUPPLY_ABILITY_REQ_REJECT`
`SSLM.SUPPLY_ABILITY_REQ_CANCEL`


### 服务定义

`SSLM.SA_REQ_APPROVE`
`SSLM.SA_REQ_REJECT`
`SSLM.SA_REQ_CANCEL`

## 4.6 导出模板



## 4.7业务规则定义





![](https://s3.bmp.ovh/imgs/2024/06/03/d8b04e182a07b74d.png)
