---
title: 供货能力申请单
hidden: true
date: 2024-06-12 09:43:26
tags:
  - 迭代
categories:
---

# 1.新增标准表结构 

```
# 供货能力申请单头表
sslm_supply_ability_change_req
# 供货能力申请单行表
sslm_supply_ability_change_line
# 供货能力申请单行附件表
sslm_supply_ability_change_att_ln
# 供货能力申请单操作记录表
sslm_supply_ability_change_record
```

# 2.表结构Groovy脚本 

```groovy
# srm-resource/init-db/srm/groovy/srm_supplier
sslm_supply_ability_change_req.groovy
sslm_supply_ability_change_line.groovy
sslm_supply_ability_change_att_ln.groovy
sslm_supply_ability_change_record.groovy
```

# 3.接口&权限

## 3.1 功能接口

### 3.1.1供货能力申请单（采）   

权限编码：`srm.partner.suplier-ability.fesc-ability-apply.ps.default`

#### A.列表页

##### 列表-整单-待提交

GET：`/v1/{organizationId}/supply-ability-change-reqs/to-submit`

返回：
```json
{  
    "totalPages": 1,  
    "totalElements": 1,  
    "numberOfElements": 1,  
    "size": 20,  
    "number": 0,  
    "content": [  
        {  
            "creationDate": "2024-06-03 13:56:26",  // 创建时间
            "createdBy": 495599,  
            "abilityReqId": "__-bxlDa-c9iJhSjBdwFOhxbQ-__",  
            "abilityReqNum": "SA202406030006",  // 单号
            "abilityReqStatus": "NEW",  
            "initiateCamp": 0,  
            "companyId": "__-y6I0cyH7xztAKenqOKhQCw-__",  
            "supplierTenantId": "__-YlG3r4DurffZeRPxiqAjpQ-__",  
            "supplierCompanyId": "__-pHTMaFNSRR8ujJ3lj7BGsg-__",  
            "abilityReqStatusMeaning": "新建",  // 状态
            "initiateCampMeaning": "采购方",  // 申请单发起方
            "companyNum": "CO00023721",  // 公司编码
            "companyName": "测试邀约子公司",  // 公司名称
            "supplierCompanyNum": "CO00000198",  // 供应商编码
            "supplierCompanyName": "厦门古龙食品有限公司",  // 供应商名称
            "createdUserName": "张华朋"  // 创建人
        }  
    ],  
    "needCountFlag": null,  
    "empty": false  
}
```

##### 列表-整单-审批中

GET：`/v1/{organizationId}/supply-ability-change-reqs/to-approval`

##### 列表-整单-全部

GET：`/v1/{organizationId}/supply-ability-change-reqs/all`

##### 列表-明细-全部

POST：`/v1/{organizationId}/supply-ability-change-lines/all`

返回结果：
```json
{  
    "totalPages": 1,  
    "totalElements": 1,  
    "numberOfElements": 1,  
    "size": 20,  
    "number": 0,  
    "content": [  
        {  
            "objectVersionNumber": 2,  
            // 和供货能力清单字段名称一致  不想写了
            "abilityChangeLineId": "__-a5LAIY-qmQqwAdBaadGUDA-__",  
            "operationType": 0,  
            "operationTypeMeaning": "新增",  // 操作类型
            "itemId": "__-oy8Vj6DDhphyedtHiLroH2SmYfqzUcv3ch2Av4LUJzw-__",  
            "itemCode": "MT2022022320",  
            "itemCategoryId": "__-DzpzvY0PkBE5_hPM1rECIg-__",  
            "itemCategoryCode": "001",  
            "supplyFlag": 1,  
            "supplyFlagMeaning": "是",  // 是否可供
            "purchaseOrganizationId": 306,  
            "purchaseOrganizationName": "总公司采购组织001",  
            "purchaseOrganizationCode": "0000",  
            "inventoryOrganizationId": "1022",  
            "inventoryOrganizationIdMeaning": "四川雅化集团三台生产厂",  
            "manufacturer": "生产厂家",  
            "adapterProducts": "适配茶品",  
            "countryId": 3,  
            "regionId": 145194,  
            "cityId": 145195,  
            "countryIdMeaning": "阿富汗",  
            "regionIdMeaning": "境外地区",  
            "cityIdMeaning": "境外城市",  
            "inventoryOrganizationMeaning": {  
                "1022": "四川雅化集团三台生产厂"  
            },  
            "itemName": "自动转单物料",  
            "itemCategoryName": "原材料2"  
        }  
    ],  
    "needCountFlag": null,  
    "empty": false  
}
```

#### B.列表页按钮

##### 新建

GET 请求   获取用户信息的  ，可以获取到部门，这个需求好像用不着，不调用也行
`/sample-send-reqs/getUserAndUserMasterUnit`

##### 批量删除

DELETE：`/v1/{organizationId}/supply-ability-change-reqs`

传入申请单头ID数组
```json
[  
    "__-CDZ74LTm8ZzTZV1rugAUDUc-uquMzaDB5tx5SZXNkhg-__",  
    "__-CDZ74LTm8ZzTZV1rugAUDdCAl4rc5gdI1nmC-seo6fU-__",  
    "__-aeSQQzoLH_NdygOMfSEGyYEPXZb1MhNmhFMgA_V81_w-__"  
]
```


##### 批量审批

审批通过：
POST：`/v1/{organizationId}/supply-ability-change-reqs/batch-approve`
审批拒绝：
post：`/v1/{organizationId}/supply-ability-change-reqs/batch-reject`
请求参数：列表查到的数据  `[{},{}]`
```json

```

返回参数：
```json


```
##### 导出


#### C.明细页

##### 头查询

GET：`/v1/{organizationId}/supply-ability-change-reqs/{abilityReqId}`

返回：
```json
{  

    "creationDate": "2024-06-03 14:35:05",  
    "createdBy": 495599,  
    "objectVersionNumber": 3,  
    "_token": "u332RWp5wzb6zhbEz7rHlui8NEgcHXhcu6C7plAqVSp+HmJ4NYvuBSd6V6At2quvJPt26lRAfWhK5zi33D3Jqv96lKN1PMGs+dt7t0BItPaZYat6MPjyd7OXePMR/yzu",  
    "abilityReqId": "__-0ICXitzmB0jWeYL6x6jp9Q-__",  
    "abilityReqNum": "SA202406030007",  
    "abilityReqStatus": "NEW",  
    "initiateCamp": 0,  
    "companyId": "__-y6I0cyH7xztAKenqOKhQCw-__",  
    "supplierTenantId": "__-YlG3r4DurffZeRPxiqAjpQ-__",  
    "supplierCompanyId": "__-pHTMaFNSRR8ujJ3lj7BGsg-__",  
    "remark": "这是一个备注233",  
    "abilityReqStatusMeaning": "新建",  
    "initiateCampMeaning": "采购方",  
    "companyNum": "CO00023721",  
    "companyName": "测试邀约子公司",  
    "supplierCompanyNum": "CO00000198",  
    "supplierCompanyName": "厦门古龙食品有限公司",  
    "createdUserName": "张华朋"  
}
```
##### 行查询

POST：`/v1/{organizationId}/supply-ability-change-lines/{abilityReqId}`

#### D.明细页按钮-头

##### 保存

POST： `/v1/{organizationId}/supply-ability-change-reqs/save`
##### 提交

POST： `/v1/{organizationId}/supply-ability-change-reqs/submit`
##### 删除

DELETE：`/v1/{organizationId}/supply-ability-change-reqs`

传入申请单头ID数组
```json
[  
    "__-CDZ74LTm8ZzTZV1rugAUDUc-uquMzaDB5tx5SZXNkhg-__",  
    "__-CDZ74LTm8ZzTZV1rugAUDdCAl4rc5gdI1nmC-seo6fU-__",  
    "__-aeSQQzoLH_NdygOMfSEGyYEPXZb1MhNmhFMgA_V81_w-__"  
]
```

##### 审批通过

`（参数参考保存)`

POST： `/v1/{organizationId}/supply-ability-change-reqs/approve`

##### 审批拒绝

`（参数参考保存)`

POST： `/v1/{organizationId}/supply-ability-change-reqs/reject`


##### 操作记录

GET： `/v1/{organizationId}/supply-ability-change-records/{abilityReqId}`

返回：
```json
{  
    "totalPages": 1,  
    "totalElements": 1,  
    "numberOfElements": 1,  
    "size": 20,  
    "number": 0,  
    "content": [  
        {  
            "_token": "u332RWp5wzb6zhbEz7rHlui8NEgcHXhcu6C7plAqVSp+HmJ4NYvuBSd6V6At2quvJPt26lRAfWhK5zi33D3JqhAh3E0BejnrDzMIOC32NAuG9TtNlyP8eJWS8x+UKOkl",  
            "recordId": "__-gQ9dlvUyE2aEUyAD9XzX_A-__",  
            "processStatus": "NEW",  
            "processDate": "2024-06-03 14:35:05",  
            "processRemark": "",  
            "processUserName": "张华朋",  
            "processStatusMeaning": "新建"  
        }  
    ],  
    "needCountFlag": null,  
    "empty": false  
}
```

#### E.明细按钮-行

##### 新增


##### 变更已有供货能力


##### 批量删除

DELETE：`/v1/{organizationId}/supply-ability-change-lines`

传入申请单头ID数组   数组包对象，实际只用到了abilityChangeLineId，改成和整单删除一样的逻辑也可以
```json
[  
    {  
        "objectVersionNumber": 2,  
        "_token": "u332RWp5wzb6zhbEz7rHlui8NEgcHXhcu6C7plAqVSqXiv4vMoDsm8oYI5/fnO/AnrAQIAqZhuxGfnIDrca6+oZmn55vCe7HJ6TChJaBA8Pim+ACTxFOs2SAG6aHHccG",  
        "abilityChangeLineId": "__-a5LAIY-qmQqwAdBaadGUDA-__",  
        "operationType": 0,  
        "operationTypeMeaning": "新增",  
        "itemId": "__-oy8Vj6DDhphyedtHiLroH2SmYfqzUcv3ch2Av4LUJzw-__",  
        "itemCode": "MT2022022320",  
        "itemCategoryId": "__-DzpzvY0PkBE5_hPM1rECIg-__",  
        "itemCategoryCode": "001",  
        "supplyFlag": 1,  
        "supplyFlagMeaning": "是",  
        "purchaseOrganizationId": 306,  
        "purchaseOrganizationName": "总公司采购组织001",  
        "purchaseOrganizationCode": "0000",  
        "inventoryOrganizationId": "1022",  
        "inventoryOrganizationIdMeaning": "四川雅化集团三台生产厂",  
        "manufacturer": "生产厂家",  
        "adapterProducts": "适配茶品",  
        "countryId": 3,  
        "regionId": 145194,  
        "cityId": 145195,  
        "countryIdMeaning": "阿富汗",  
        "regionIdMeaning": "境外地区",  
        "cityIdMeaning": "境外城市",  
        "inventoryOrganizationMeaning": {  
            "1022": "四川雅化集团三台生产厂"  
        },  
        "itemName": "自动转单物料",  
        "itemCategoryName": "原材料2"  
    }  
]
```


##### 批量编辑

POST：`/v1/{organizationId}/supply-ability-change-lines/batch-edit`

传入申请行单个对象，包含申请头ID以及需要批量编辑的字段
```json
# 
```


#### F.工作流接口

##### 审批通过

GET：`/wfl/approve/{abilityReqId}`

##### 审批拒绝

GET：`/wfl/reject/{abilityReqId}`

##### 工作流撤销

GET：`/wfl/cancel/{abilityReqId}`


### 3.1.2 供货能力申请单（供）

#### 全新暂时加到我收到的调查表  后面删掉


#### A.列表页

##### 列表-整单-待提交

GET：`/v1/{organizationId}/supply-ability-change-reqs/sup/to-submit`

##### 列表-整单-全部

GET：`/v1/{organizationId}/supply-ability-change-reqs/sup/all`


#### B.列表页按钮

##### 新建

GET 请求
`/sample-send-reqs/getUserAndUserMasterUnit`

##### 批量删除

DELETE：`/v1/{organizationId}/supply-ability-change-reqs`

传入申请单头ID数组
```json
[  
    "__-v6tGtfUxlfPXF7YPFb_UkQ-__",  
    "__-IljbBjmZCYa10n690vuTMQ-__"  
]
```

##### 导出


#### C.明细页

##### 头查询

GET：`/v1/{organizationId}/supply-ability-change-reqs/sup/{abilityReqId}`
返回结果：
```json
{  
	"usePurchaseItemFlag": 1, // 是否允许供应商直接选择采购方物料/品类  1：是 0：否
    "creationDate": "2024-06-03 14:35:05",  
    "createdBy": 495599,  
    "objectVersionNumber": 3,  
    "_token": "u332RWp5wzb6zhbEz7rHlui8NEgcHXhcu6C7plAqVSp+HmJ4NYvuBSd6V6At2quvJPt26lRAfWhK5zi33D3Jqv96lKN1PMGs+dt7t0BItPaZYat6MPjyd7OXePMR/yzu",  
    "abilityReqId": "__-0ICXitzmB0jWeYL6x6jp9Q-__",  
    "abilityReqNum": "SA202406030007",  
    "abilityReqStatus": "NEW",  
    "initiateCamp": 0,  
    "companyId": "__-y6I0cyH7xztAKenqOKhQCw-__",  
    "supplierTenantId": "__-YlG3r4DurffZeRPxiqAjpQ-__",  
    "supplierCompanyId": "__-pHTMaFNSRR8ujJ3lj7BGsg-__",  
    "remark": "这是一个备注233",  
    "abilityReqStatusMeaning": "新建",  
    "initiateCampMeaning": "采购方",  
    "companyNum": "CO00023721",  
    "companyName": "测试邀约子公司",  
    "supplierCompanyNum": "CO00000198",  
    "supplierCompanyName": "厦门古龙食品有限公司",  
    "createdUserName": "张华朋"  
}
```
##### 行查询

POST：`/v1/{organizationId}/supply-ability-change-lines/{abilityReqId}`

#### D.明细页按钮-头

##### 保存

POST： `/v1/{organizationId}/supply-ability-change-reqs/sup/save`
##### 提交

POST： `/v1/{organizationId}/supply-ability-change-reqs/sup/submit`
##### 删除

DELETE：`/v1/{organizationId}/supply-ability-change-reqs`

传入申请单头ID数组
```json
[  
    "__-CDZ74LTm8ZzTZV1rugAUDUc-uquMzaDB5tx5SZXNkhg-__",  
    "__-CDZ74LTm8ZzTZV1rugAUDdCAl4rc5gdI1nmC-seo6fU-__",  
    "__-aeSQQzoLH_NdygOMfSEGyYEPXZb1MhNmhFMgA_V81_w-__"  
]
```


##### 操作记录

GET： `/v1/{organizationId}/supply-ability-change-records/{abilityReqId}`

#### E.明细按钮-行

##### 新增


##### 变更已有供货能力


##### 批量删除

DELETE：`/v1/{organizationId}/supply-ability-change-lines`

传入申请行ID对象的数组
```json
[  
    {  
        "abilityChangeLineId": "__-CNzKB7nYI-lnTjgD1Gqvjw-__"  
    }  
]
```


##### 批量编辑

POST：`/v1/{organizationId}/supply-ability-change-lines/sup/bach-update`

传入申请行单个对象，包含申请头ID以及需要批量编辑的字段
```json
# 参考编辑供货能力清单 行批量编辑
当勾选指定行进行批量编辑时：和整个页面保存传入同样的参数，头字段增加selectAllFlag = 0 
当不勾选行，全部批量编辑时：传入supplyAbilityChangeLineUpdateDTO，包含需要更新的字段

{
"selectAllFlag": 1,
"supplyAbilityChangeLineUpdateDTO": {},
"supplyAbilityChangeLineList": [{}] // 新增行
}

{
"selectAllFlag": 0,
"supplyAbilityChangeLineList": [{}] // 更新指定行
}
```



### 3.1.3 供货能力查询（采）

参考标准功能  供货能力清单管理

列表：
GET：`/supply-abilitys`
明细
GET：`/supply-abilitys/{supplyAbilityId}`

### 3.1.4 供货能力查询（供）

##### 列表查询

```
// 和供货能力清单管理查询接口参数一致
/supply-abilitys/sup

/supply-abilitys/sup/detail-post
/v1/{organizationId}/supply-abilitys/sup/detail-post

明细
GET：`/supply-abilitys/{supplyAbilityId}`

```
## 3.3 采购方菜单权限

```
// 需要查询用户信息 把带单权限加上
/sample-send-reqs/getUserAndUserMasterUnit

```


# 4.配置项 

## 4.1 值集

`SSLM.SUPPLY_ABILITY_REQ_STATUS`
`SSLM.INITIATE_CAMP`
`SSLM.ABILITY_OPERATION_TYPE`
`SSLM.SUPPLY_ABILITY_REQ_APPROVE_TYPE`
`SSLM_USER_SUPPLIER`
`SSLM.USER_AUTHORITY_COMPANY_DIM`
`SSLM.COMPANY_CUSTOMER_FOR_SUP`
`SUPPLY_ABILITY_REVIEW_LINE_STATUS`
`SCUX.EPPEN_ABILITY_CHANGE_REQ_TYPE`
`SSLM.USER_AUTH_COMPANY_SUPPLIER`


##### 视图

`SSLM.USER_AUTH_COMPANY_SUPPLIER`
## 4.2 编码规则

`SSLM.SUPPLY_ABILITY_REQ_NUM`

## 4.3 报错信息

`sslm.error.supplier_uncompleted_ability_req`
`sslm.error.company_uncompleted_ability_req`
`sslm.error.company_supplier_uncompleted_ability_req`
`sslm.error.company_customer_uncompleted_ability_req`
`sslm.error.supplier_supply_ability_req_status`
`sslm.error.supplier_has_uncompleted_ability_req`

`error.ability.req.line.data.repeat`
`error.ability.req.line.with.basic.data.repeat`

`error.ability.req.line.is.empty`
`error.supplier_ability_req_line_no_item`


## 4.4 业务对象

`SRM_SSLM_SUPPLY_ABILITY_CHANGE_REQ`

## 4.5 工作流

##### 流程分类：SSLM_SA_REQ_CATEGORY
##### 流程单据：SSLM_SA_REQ_DOCUMENT
##### 流程编码：SSLM.SUPPLY_ABILITY_REQ_WFL    这个没同步


### 接口定义    这三个没找到

`SSLM.SUPPLY_ABILITY_REQ_APPROVE`    
`SSLM.SUPPLY_ABILITY_REQ_REJECT`
`SSLM.SUPPLY_ABILITY_REQ_CANCEL`


### 服务定义

`SSLM.SA_REQ_APPROVE`
`SSLM.SA_REQ_REJECT`
`SSLM.SA_REQ_CANCEL`

## 4.6 导出模板

#### 导出租户业务对象：`SRM_C_SUPPLY_ABILITY_CHANGE_REQ`

###### 导出模板：



## 4.7业务规则定义

##### SITE.SSLM.SUPPLY.ABILITY.REQ.APPROVE
##### SITE.SSLM.SUPPLY.ABILITY.AUTH.ITEM.LOV

## 4.8 多语言


`sslm.supplyAbilityReq.model.supply.ability.req.export`
`sslm.supplyAbilityReq.model.supply.ability.req.initiateCamp`
`sslm.supplyAbilityReq.model.supply.ability.req.approve.type`
`sslm.supplyAbilityReq.model.supply.ability.req.approve.fun`
`model.supply.ability.req.auth.item.lov.sup`


## 4.9 配置表



##### 供应商可访问API白名单

三级菜单：供货能力申请单（供）

API：

```
get
/v1/{organizationId}/supply-ability-change-reqs/sup/all

get
/v1/{organizationId}/supply-ability-change-reqs/sup/to-submit

get
/v1/{organizationId}/supply-ability-change-reqs/sup/{abilityReqId}

get
/v1/{organizationId}/supply-ability-change-reqs/sup/all-export

post
/v1/{organizationId}/supply-ability-change-reqs/sup/save

post
/v1/{organizationId}/supply-ability-change-reqs/sup/submit

delete
/v1/{organizationId}/supply-ability-change-reqs

post
/v1/{organizationId}/supply-ability-change-lines/sup/all

post
/v1/{organizationId}/supply-ability-change-lines/sup/all-export

post
/v1/{organizationId}/supply-ability-change-lines/{abilityReqId}

delete
/v1/{organizationId}/supply-ability-change-lines

post
/v1/{organizationId}/supply-ability-change-lines/sup/batch-edit

post
/v1/{organizationId}/supply-ability-change-lines/batch-edit

delete
/v1/{organizationId}/supply-ability-change-lines

get
/v1/{organizationId}/supply-ability-change-records/{abilityReqId}

get
/v1/{organizationId}/supply-ability-change-att-lns/{abilityChangeLineId}

post
/v1/{organizationId}/supply-ability-change-att-lns

delete
/v1/{organizationId}/supply-ability-change-att-lns

供货能力清单查询

post
/v1/{organizationId}/supply-abilitys/sup/detail-post

post
/v1/{organizationId}/supply-abilitys/detail-post

post
/v1/{organizationId}/supply-abilitys/sup/detail-post-export

post
/v1/{organizationId}/supply-ability-lines/{supplyAbilityId}

get
/v1/{organizationId}/supply-ability-change-reqs/tab-count-sup



```
















![](https://s3.bmp.ovh/imgs/2024/06/03/d8b04e182a07b74d.png)




![](https://s3.bmp.ovh/imgs/2024/06/06/2beaa1b65ba554a7.png)
