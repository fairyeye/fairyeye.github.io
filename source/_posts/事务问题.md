---
title: Transactional注解
date: 2020年9月17日18:59:55
tags: ""
categories: "数据库"
description: 事务回滚
---

方法A中调用B后再调用C,三个方法中均有插入数据后再查询数据

B方法的注解：@Transactional(propagation=Propagation.REQUIRES_NEW) --不管是否存在事务,都创建一个新的事务,原来的挂起,新的执行完毕,继续执行老的事务

C方法的注解：@Transactional(propagation=Propagation.REQUIRED) --如果有事务,那么加入事务,没有的话新建一个

1、当方法B或者C报错时，A、B、C方法都回滚

2、当方法A、B、C异常被捕获时，A、B、C事务不回滚（a、b、c均入库）

3、当方法BC执行后，方法A报错时，A、C事务回滚，B事务不回滚（b数据入库）


A方法向表中添加数据a，在查询该表能得到数据a

B方法向表中添加数据b，再查询该表能得到数据b

C方法向表中添加数据c，再查询该表能得到数据a，b，c

带有注解@Transactional(propagation=Propagation.REQUIRES_NEW)的方法走完之后，数据就会被提交入库

另外需要注意方法内部调用@Transactional(propagation=Propagation.REQUIRES_NEW)注解不生效，比如A和B都在同一个方法中，A调用B，B方法是此注解，则不生效。同样，AOP拦截也拦截不到B

```
public enum Propagation {
    REQUIRED(0),
    SUPPORTS(1),
    MANDATORY(2),
    REQUIRES_NEW(3),
    NOT_SUPPORTED(4),
    NEVER(5),
    NESTED(6);

    private final int value;

    private Propagation(int value) {
        this.value = value;
    }

    public int value() {
        return this.value;
    }
}
```

七种事物传播类型 默认为：`REQUIRED`