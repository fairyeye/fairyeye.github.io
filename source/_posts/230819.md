
### PUR-


### PUR-21898

#### spuc，resource

```
update sodr_po_header set settle_pe_supplier = concat(ifnull(settle_supplier_id,'null'),'-',ifnull(settle_erp_supplier_id,'null')) where (settle_supplier_id is not null or settle_erp_supplier_id is not null);





select count(1) from sodr_po_header where (settle_supplier_id is not null or settle_erp_supplier_id is not null); -- 178826
select count(1) from sodr_po_header;-- 9596554
```


### PUR-21731
```
1. subErpSupplierId: 277766
2. subErpSupplierName: "协议本"
3. subSupplierCode: "CO00024895"
4. subSupplierFlag: 0
5. subSupplierId: 1089712
6. subSupplierName: "协议平台供应商1"
7. supplierCompanyId: "__-gYSNy2v7rnwsDtO5_UGeMA-__"
```

##### pur-21731
	批量编辑

#### 种子数据
值集：SODR.PO_TABLE_FIELD
配置表：sodr_po_config_init
代码： 


### PUR-22219

前置：SPUC_PCI_PO_HEADER_CONFIRM_DETAIL

返回消息：error.pci.confirm_order_attchment_is_empty



### PUR-22269

埋点：SPUC_ORDER_LINE_IMPORT
				SPUC_ORDER_PRICE_SOURCE_TYPE


### PUR-21594

值集：SCUX.CHAM_CONFIDENTIAL_DOCUMENT_LEVEL
埋点：SPUC_ORDER_PRICE_SOURCE_TYPE



### pur-22034

独立脚本：SCUX_INOV_QUERY_QUANTITY_BY_COMPANY_ITEM
API：SCUX_INOV_QUERY_QUANTITY_BY_COMPANY_ITEM
QB：SCUX_INOV_QUERY_QUANTITY_BY_COMPANY_ITEM


### PUR-22249
标准代码埋点：feature-pur-22249
适配器： 
提交：SPUC_SUBMIT_PO,SPUC_AFTER_SUBMIT_PO
行取消联动头：SPUC_LINE_CANCEL_PO_HEADER
电商行取消联动头：SPUC_LINE_CANCEL_PO_HEADER
整单取消：SPUC_ALL_CANCEL_PO_HEADER
	取消时，判断非新建审批拒绝
审批拒绝：SPUC_ORDER_REJECTED_EVENT
	区分新建审批拒绝
撤销：SPUC_ORDER_REVOCATION_EVENT_AFTER
重新同步：SPUC_RE_SYNC_ERP

值集：SPUC.SYNC_EXP_TYPE、SPUC.SYNC_INTERFACE_TYPE

返回消息：error.spuc.supplier_oreder_nums_is_zero
配置表：scux_srm_hanslaser_supplier_life_cycle_place_order_control


```sql
# 同步失败 写入同步记录表
and spcr.sync_status = 'FAIL'  
and spcr.po_line_id is null  
and spcr.po_line_location_id is null
```

pur-20078 配置表：scux_srm_hanslaser_supplier_life_cycle_place_order_control



### pur-21957

-- 查询复制新的供应商附件
独立脚本：SCUX_QUANTUM_PO_COPY_UUID，SCUX_QUANTUM_UPDATE_SUP_ATTACHMENT_UUID
API：SCUX_QUANTUM_PO_COPY_UUID，SCUX_QUANTUM_UPDATE_SUP_ATTACHMENT_UUID
-- api发布 更新供应商附件UUID

返回消息：error.spuc.quantum_po_status_is_not_delivery


```
org.srm.purchasecooperation.order.api.controller.v2.PoExternalController#deliveryExportToErp

org.srm.purchasecooperation.order.api.controller.v2.PoReceiptInteractionController#poInitDeliveryWorkbench

org.srm.purchasecooperation.order.api.controller.v1.PoHeaderController#exportErp
```


### pur-22195

API+独立脚本：SCUX_DREAME_QUERY_DRAWING_LINE_BY_ITEM

![](https://s3.bmp.ovh/imgs/2023/08/01/18aa18c75d251422.png)




### pur-22427

-- 删除二开 恢复标准 `hrpt_print_report`

```sql
-- hrpt_print_report
INSERT INTO `srm`.`hrpt_print_report` (`report_id`, `doc_id`, `report_uuid`, `report_code`, `dataset_code`, `report_name`, `report_type`, `enabled_flag`, `remark`, `tenant_id`, `object_version_number`, `created_by`, `creation_date`, `last_updated_by`, `last_update_date`) VALUES (67, 6, '66032d351f364f31b44f4bd5e1442dfe', 'SODR.PO_REPT_NEW', 'SODR.STD.ORDER_DATASET', '标准采购订单打印模板', 'PDF', 1, NULL, 30, 6, 430, '2022-09-29 20:03:26', 495599, '2023-06-08 11:12:32');
INSERT INTO `srm`.`hrpt_print_report` (`report_id`, `doc_id`, `report_uuid`, `report_code`, `dataset_code`, `report_name`, `report_type`, `enabled_flag`, `remark`, `tenant_id`, `object_version_number`, `created_by`, `creation_date`, `last_updated_by`, `last_update_date`) VALUES (388, 6, 'a8589263034d4ba3a0074c376fd36a92', 'SODR.PO_REPT_NEW2', 'SODR.STD.ORDER_DATASET_1', '标准采购订单打印模板_库存组织', 'PDF', 1, NULL, 30, 1, 495599, '2023-06-08 10:20:05', 495599, '2023-06-08 10:20:05');
INSERT INTO `srm`.`hrpt_print_report` (`report_id`, `doc_id`, `report_uuid`, `report_code`, `dataset_code`, `report_name`, `report_type`, `enabled_flag`, `remark`, `tenant_id`, `object_version_number`, `created_by`, `creation_date`, `last_updated_by`, `last_update_date`) VALUES (389, 6, '8450c0aebecc4fdbba8796b1ac624eda', 'SODR.PO_REPT_NEW3', 'SODR.STD.ORDER_DATASET_1_1', '测试', 'PDF', 1, NULL, 30, 1, 495599, '2023-06-08 11:22:51', 495599, '2023-06-08 11:22:51');



```


### pur-22126

埋点：SPUC_ALL_CANCEL_PO_LINE
SPUC_LINE_CANCEL_PO_LINE_NEW
SPUC_LINE_CANCEL_PO_LINE
%%SPUC_LINE_CLOSE_PO_LINE
SPUC_ALL_CLOSE_PO_LINE%%
独立脚本：SCUX_XTALPI_CHANGE_QUERY_PAYMENT_STAGE
SCUX_XTALPI_PO_CLOSE_CHECK
SCUX_XTALPI_PO_LINE_CLOSE_CHECK
SCUX_XTALPI_PO_LOCATION_PURCHASER_AFTER

取消查询预付款、取消保存预付款
API+独立脚本：SCUX_XTALPI_CANCEL_QUERY_PAYMENT_STAGE
	SCUX_XTALPI_CANCEL_SAVE_PAYMET_STAGE

返回消息：scux_xtalpi.line_cancel_faild
	scux_xtalpi.line_close_faild
	scux.xtalpi.error.payment_save_faild_pre_pay_is_no
	scux.xtalpi.error.payment_rate_more_than_100
	scux.xtalpi.error.paymet_stage_save_faild_amount_not_eq_po_amount
	scux.xtalpi.error.payment_save_faild.data_is_empty

API挂载：
```
@MarmotApiPoint(apiCode = "PO_HEADER_CLOSE")
@MarmotApiPoint(apiCode = "PO_LOCATION_CLOSE")
PO_LOCATION_PURCHASER
```

QB:  SCUX_XTALPI_QUERY_PREPAY_FLAG_BY_LINE

### pur-21956

埋点：SPUC_ORDER_CONFIRM_AFTER  
	注意ConfirmType！=LINE_CONFIRM
重新同步：SPUC_RE_SYNC_ERP

  
SPUC.SYNC_EXP_TYPE_BY_LINE，SPUC.SYNC_INTERFACE_TYPE，SPUC.SYNC_EXP_TYPE


### pur-21994

提供API  待定  事务锁



### PUR-22331

返回消息：spuc.query_param_sup_tenant_is_empty

配置表：srm_supplier_iso_ignore_list
供应商数据隔离忽略